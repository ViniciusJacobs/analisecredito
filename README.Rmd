---
title: "Análise de Perfil: Concessão de Crédito"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Objetivo
  
- Demonstrar algumas técnicas de AED; 
- Apresentar as caracteristicas demograficas e financeiras dos clientes presentes na base de dados; 
- Identificar quais variáveis do modelo explicam quais são os clientes bons e ruins;
- Elaborar um modelo de previsão para o problema de negócio.



```{r message=FALSE, warning=FALSE}

library(tidyverse)
library(tidyr)
library(patchwork)
devtools::load_all()

```

Leitura do data.frame e visualização das variáveis
```{r}
df_credito <- read_rds("data/credito.rds")
glimpse(df_credito)
```

Contagem dos valores NAs por váriavel do modelo
```{r, echo=FALSE}

titulos_col <- df_credito %>%
  names


for(i in 1:length(titulos_col)){
 x <- contagem_nas(df_credito, titulos_col[i])[[1]]
  if(x>0){
   print(titulos_col[i])
   print(x)
  }

}

```

#Avaliação para substituição dos NA's
```{r warning=FALSE}

#As variáveis moradia, estado_civil e trabalho, apresentaram um número de NA's pouco expressivo, foi considerado como ERRO no cadastro. Para esse estudo não foi feita análise, mas sim a alteração dos campos NA's para indefinido.

df_credito_ajustado <- df_credito%>%
  tidyr::replace_na(replace = list(moradia = "indefinido",
                                   estado_civil = "indefinido",
                                   trabalho = "indefinido"))

#As variáveis renda, ativos e dívidas, foram objeto de análise, gráfica e estatística, conforme abaixo:

grafico_rel_renda <- df_credito_ajustado %>%
  filter(!is.na(renda)) %>%
  ggplot() +
  aes(x = status, y = log(renda)) +
  geom_boxplot(fill = "#4682B4")+
  labs( title = "Relação: Renda x Status",
        x = "Status",
        y = "Renda")+
  theme_gray()+
  theme(
    legend.position = "right",
    plot.title = element_text(
      hjust = 0.5
    )
  )


grafico_rel_ativos <- df_credito_ajustado %>%
  filter(!is.na(ativos)) %>%
  ggplot() +
  aes(x = status, y = log(ativos)) +
  geom_boxplot(fill = "#4682B4")+
  labs( title = "Relação: Ativos x Status",
        x = "Status",
        y = "Ativos")+
  theme_gray()+
  theme(
    legend.position = "right",
    plot.title = element_text(
      hjust = 0.5
    )
  )

grafico_rel_dividas <- df_credito_ajustado %>%
  filter(!is.na(dividas)) %>%
  ggplot() +
  aes(x = status, y = log(dividas)) +
  geom_boxplot(fill = "#4682B4")+
  labs( title = "Relação: Ativos x Status",
        x = "Status",
        y = "Dividas")+
  theme_gray()+
  theme(
    legend.position = "right",
    plot.title = element_text(
      hjust = 0.5
    )
  )

patchwork::wrap_plots(grafico_rel_renda + grafico_rel_dividas + grafico_rel_ativos) 

```


Retirada dos NA's
```{r }

  df_credito_ajustado <- df_credito%>%
  replace_na(replace = list(moradia = "indefinido",
                                   estado_civil = "indefinido",
                                   trabalho = "indefinido"))

  df_credito_ajustado <- df_credito_ajustado %>%
  replace_na(replace = list(renda = mean(df_credito_ajustado$renda, na.rm = TRUE),
                                   ativos = mean(df_credito_ajustado$ativos, na.rm = TRUE),
                                    dividas = mean(df_credito_ajustado$dividas, na.rm = TRUE)))
df_credito_ajustado <- df_credito_ajustado %>%
  mutate(faixa_etária = case_when(idade<=25 ~ "(Abaixo dos 25 anos)",
                                  idade<=35 ~ "(Entre 26 e 35 anos",
                                  idade<=45 ~ "Entre 36 e 45 anos",
                                  idade<=55 ~ "Entre 46 e 55 anos",
                                  idade<85 ~"Acima dos 55 anos")) %>%
  relocate(faixa_etária, .after = idade)



```
